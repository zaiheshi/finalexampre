### 局域网

#### 问题
1. 如何解决局域网通信中的冲突问题？
2. 如何来搭建一个局域网？
3. 如何将几个局域网连接成更大的局域网？如何将一个局域网分割成小的局域网？
4. 局域网在提速的过程中遇到了哪些主要问题，如何解决？
#### 局域网的主要特点
- 网络为一个单位所拥有，且地理范围和站点数目均有限。

#### 局域网主要优点
- 能方便地共享昂贵的外部设备、主机以及软件、数据。从一个站点可访问全网
- 便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变
- 提高了系统的可靠性、可用性和残存性。
#### 局域网的拓扑结构

![局域网的拓扑结构](/home/eve/计网复习/第四局域网/局域网的拓扑结构.png)


1. 星形网(Star topology)
  - 特征 : 
    1. 每个设备都同一个中心控制器相连，这个控制器称为HUB。
    2. 设备之间并不连接，不能直接通信。
    3. 设备之间的通信必须通过HUB进行转接。
  - 优点 : 
    1. 成本比网状结构下降。因为链路数和端口数减少。
    2. 网络容易配置和安装。
    3. 相对的可靠性。如果一个链路出错，不会影响到其他链路
  - 缺点 : 
    1. 如果HUB出错，则网络通信全部中断。
    2. 比其他方式如总线，需要更多的电缆。
2. 总线网(Bus topology)
  - 特征：
    1. 一根电缆连接所有的设备。
    2. 设备通过连线同转发器相连，而转发器则连在线路上。线路两端用终端器封闭。
  - 优点：
    1. 容易安装。可按最佳路径来铺设电缆。
    2. 使用较少的电缆。 
  - 缺点：
    1. 重新配置和错误隔离比较困难。
    2. 总线中的任何一处发生错误，都会使通信中断。
3. 环形网(Ring topology)
  - 特征：
    1. 所有设备连接成一个环形。
    2. 每一个设备包含一个中继器，把收到的信息转发到下一个站点，直到目的地。
    3. 每个设备有两个端口，一个用作输入，另一个用作输出。
  - 优点：
    1. 容易安装和重配置，每一个设备只同它的邻居相连，增加设备也方便。
    2. 错误检测比较方便。一旦设备没有收到信号，则它的输入链路会有问题。 
  - 缺点：
    1. 单向通信。用双向环来克服。
    2. 一个站点出错或关闭会中断通信，一个链路中断也会产生同样问题
4. 树形网(Tree)
  - 特征：
    1. 星型网络的变种，大多数设备连接到二级HUB(集线器)上，而二级HUB则连到中央HUB上。
    2. 中央控制单元可以是SWITCH/HUB
  - 优缺点：同星型类似。
    1. 单一HUB可以连接更多设备，增加信号传输距离。
    2. 可以隔离不同的计算机，并可提供优先通信。即连在一个HUB上的计算机通信速率最快。

#### Fully connected mesh topology

![Fully connected mesh topologyFully connected mesh topology](/home/eve/计网复习/第四局域网/Fully connected mesh topologyFully connected mesh topology.png)

- 优点 : 可用、可靠、安全、排查容易
- 缺点 : 成本大、安装困难
- 应用 : 广域网，Internet骨干网

#### 信道分配策略

![信道分配策略](/home/eve/计网复习/第四局域网/信道分配策略.png)

1. ALOHA系统：美国夏威夷大学的 ALOHA 网，该网通过无线信道将各分校的远程终端接到本部的主机上

2. CSMA(Carrier Sense Multiple Access Protocol)

   ![几种随机访问协议的性能比较](/home/eve/计网复习/第四局域网/几种随机访问协议的性能比较.png)

   - 定义
     1. 即所谓“先听后说
     2. 希望传输的站首先对信道进行监听以确定是否有别的站在传输。
     3. 若信道空闲，该站可以传输，否则，该站将按一定算法退避一段时间后再试

   - 分类

     - 1-坚持CSMA

        1. 步骤：
           - 监听信道，若信道空闲就发送；

           - 若信道忙则继续坚持监听，直至检测到信道空闲后就立即(以概率1)发送；

           - 若有冲突，则随机等待一段时间，重复步骤(1)。

        2. 优点：只要信道空闲，数据就立即得到发送；
        3. 缺点：若有两个或两个以上的站点等发送，冲突就不可避免。

     - 非坚持CSMA
       1. 步骤
           - 监听信道，若信道空闲就发送;
           - 若信道忙则放弃(不坚持)监听，随机等待一段时间，重复步骤(1)
        2. 优点：采用随机的重发延迟时间可以减少冲突的可能性
        3. 缺点：即使有几个站有数据要传送，信道仍然可能处于空闲状态，信道利用率较低。

     - P-坚持CSMA

        1. 步骤
           - 监听信道，若信道空闲就以概率p发送数据，以概率1-p 延迟至下一个时间片；
           - 若信道忙则继续坚持监听，直至下一个时间片；
           - 至下一个时间片后重复步骤 (1)。
        2. 关键问题：如何选择p的有效值？

3. CSMA/CD

   - ![CSMA_CD](/home/eve/计网复习/第四局域网/CSMA_CD.png)
   - 重要特性
      - 发送的不确定性：每个站在发送数据之后的一小段时间内，存在着遭遇碰撞的可能性；
      - 半双工通信
        - 使用 CSMA/CD 协议的以太网不能进行全双工通信而只能进行双向交替通信（半双工通信）；
        - 整个以太网的平均通信量远小于以太网的最高数据率。

4. 传统以太网(数据链路层被拆分为MAC与LLC两个子层)

   ![LLC_transparent](/home/eve/计网复习/第四局域网/LLC_transparent.png)

   1. MAC（Media Access Control）：介质访问控制子层，负责解决设备使用共享信道的问题

   2. LLC（Logical Link Control）：逻辑链路控制子层，负责完成通常意义下的数据链路层功能，如差错控制、流量控制等。

   3. 分成两个子层的好处：

      - 不同的物理网络，物理层与MAC子层不同， 而LLC子层相同，网络的上层协议可运行于任何一种IEEE 802标准的局域网上，具有透明性。
      - 这种分层方法也使得IEEE 802标准具有良好的可扩充性，可以很方便地接纳新的介质与介质访问控制方法

   4. IEEE802标准

      - 802.3：CSMA/CD总线网的 MAC 和 PHY 规范

      - 802.11：无线局域网（WLAN）的 MAC 和 PHY 规范

      - 802.14：电缆电视（Cable-TV）网上的数据传输

      - 802.15：无线个人网（WPAN / Bluetooth）

   5. 网卡的作用
      - 进行串行/并行转换。
      - 对数据进行缓存。对数据进行缓存。
      - 在计算机的操作系统安装设备驱动程序。
      - 实现以太网协议。
   6.  CSMA/CD 协议 (这里要重点看，内容太多，不好记录)
      - 争用期/冲突检测时间(以太网的端到端往返时延 2 称为争用期，或碰撞窗口。)
      - 

   7. 思考提

      - 以太网采用1-CSMA/CD的MAC策略，其实际上的信道利用率最大值Smax是多少？
      - 在CSMA/CD中，为什么帧的发送时延不得小于2 ?
      - 为什么在以太帧中目的地址位于源地址之前？
      - 为什么以太帧的有效负载长度在46-1500字节之间？

   8. 传统已太网连接方法(这样，以太网就有四种不同的物理层。)

      ![10base-T](/home/eve/计网复习/第四局域网/10base-T.png)

      - 铜缆（粗缆==>10BASE5或细缆==>10BASE2）
      - 铜线（双绞线10BASE-T）
      - 光缆(10BASE-F)

   9. 集线器的特点

      - 集线器是使用电子器件来模拟实际电缆线的工作，因此整个系统仍然像一个传统的以太网那样运行。
      - 使用集线器的以太网在逻辑上仍是一个总线网，各工作站使用的还是 CSMA/CD 协议，并共享逻辑上的总线
      - 集线器很像一个多端口的转发器，工作在物理层。

   10. 以太网的mac层

       - 路由器由于同时连接到两个网络上，因此它有两块网卡和两个硬件地址。
       - 以太网MAC帧格式有两种标准 
         - DIX Ethernet V2 标准*(最常用的 MAC 帧是以太网 V2 的格式)
         - IEEE 的 802.3 标准
       - 无效的 MAC 帧* 
         - 数据字段的长度与长度字段的值不一致；
         - 帧的长度不是整数个字节；
         - 用收到的帧检验序列 FCS 查出有差错；
         - 数据字段的长度不在 46 ~ 1500 字节之间。
         - 对于检查出的无效 MAC 帧就简单地丢弃。以太网不负责重传丢弃的帧。

   11. 三种局域网的比较(CSMA/CD)

       - 优点
         - 协议简单、安装容易、总线可靠性高，在局域网中获得了广泛应用。
         - 该协议给用户提供均等的访问权，在轻负载情况下，CSMA/CD有良好的延迟特性和吞吐能力。
       - 缺点
         - 必须进行冲突检测，而且对最小帧长度有一定限制，因而对短报文存在带宽浪费现象。
         - CSMA/CD随负载的增加，冲突增加，性能迅速下降
         - 由于随机竞争发送和延迟等待，无法预知数据传输的最大延迟，又没有优先级，因此不适用于实时系统。

   12. 三种局域网的比较(Token Ring)

       - 优点
         - 可使用多种传输介质，可采用全数字技术，支持优先级，支持短帧；
         - 将令牌环网做成星形环可自动检测和隔离电缆故障；
         - 在高负载下可以获得很高的传输效率。
       - 缺点
         - 在低负载下时延较大；
         - 由于采用集中式控制，对监控站的可靠性要求较高

   13. 三种局域网的比较(Token Bus)

       - 优点
         - 具有极好的吞吐能力，而且其吞吐量随数据传输速率增加而增加，并随介质饱和而稳定下降。
         - 它不需冲突检测，可以调节对介质的访问权，既可以公平地访问，又可以提供优先级，而且可以预知数据在网中的最大延迟，适用于实时系统。
       - 缺点
         - 要进行逻辑环的维护，而且物理层规范复杂。
         - 在轻负载情况下可能要等待许多无用的令牌帧传递，从而减少了对信道的利用率。

   14. 比较的结论

       - 在很重的负载下IEEE 802.3局域网彻底不能用，而基于令牌的局域网则可达到接近于100％的效率。若负载范围是从轻到中等，则三种局域网都能胜任。
       - 从市场情况看，以太网拥有最大的市场，而令牌总线网则很少使用。

5. 扩展的局域网

   1. 在物理层扩展局域网-中继器/集线器

   2. 中继器

      - 作用
        - 在物理层上实现局域网网段的互连，主要起到信号再生放大、延长网络距离的作用。
      - 优点
        - 安装简单、使用方便、价格便宜。
      - 缺点
        - 不能够无限制地扩展网络长度。
        - 中继器处理的对象是数据比特，它不能识别数据链路层的帧格式或网络层的分组格式。不提供网段之间的隔离。
      - 注意：中继器不是一个信号放大器。

   3. 集线器HUB(用多个集线器可连成更大的局域网)

      - 多端口的中继器，属于物理层设备
      - 功能：在网段之间拷贝比特流，信号整形和放大
      - 可改变网络物理拓扑形式：总线连接—>星形连接
      - 端口数：常见的有8，12，16，24口

   4. 用集线器扩展局域网

      - 优点
        - 使原来属于不同碰撞域的局域网上的计算机能够进行跨碰撞域的通信。
        - 扩大了局域网覆盖的地理范围。
      - 缺点
        - 碰撞域增大了，但总的吞吐量并未提高
        - 如果不同的碰撞域使用不同的数据率，那么就不能用集线器将它们互连起来。

      ==========================================================================================================================================================================

   5. 在数据链路层扩展局域网-网桥

      - 层次
        - 一种数据链路层中继设备。
      - 作用
        - 能够扩大网络地理范围
        - 帧的过滤和转发
        - 网桥具有隔离网段的功能(可以将一个大的局域网分成若干个网段，使网段间的通信量小于每个网段内部的通信量，以减少整个局域网中的信息流量。)
        - 连接多个不同拓朴结构的网段。

   6. 网桥

      - 优点
        - 过滤通信量。
        - 扩大了物理范围。
        - 提高了可靠性。
        - 可互连不同物理层、不同 MAC 子层和不同速率（如10 Mb/s 和 100 Mb/s 以太网）的局域网。
      - 缺点
        - 存储转发增加了时延。 
        - 在MAC 子层并没有流量控制功能。 
        - 具有不同 MAC 子层的网段桥接在一起时时延更大。
        - 网桥只适合于用户数不太多(不超过几百个)和通信量不太大的局域网，否则有时还会因传播过多的广播信息而产生网络拥塞。这就是所谓的广播风暴。  

   7. 网桥和集线器（或转发器）不同*

      - 集线器在转发帧时，不对传输媒体进行检测。
      - 网桥在转发帧之前必须执行 CSMA/CD 算法。
        - 若在发送过程中出现碰撞，就必须停止发送和进行退避。
        - 在这一点上网桥的接口很像一个网卡。但网桥却没有网卡。
      - 由于网桥没有网卡，因此网桥并不改变它转发的帧的源地址。 

   8. 目前使用得最多的网桥是透明网桥：“透明”是指局域网上的站点并不知道所发送的帧将经过哪几个网桥，因为网桥对各站来说是看不见的。

      ==========================================================================================================================================================================

   9. 多端口网桥——以太网交换机 

      - 以太网交换机通常都有十几个端口。因此，以太网交换机实质上就是一个多端口的网桥，可见交换机工作在数据链路层。
      - 特点
        - 以太网交换机的每个端口都直接与主机相连，并且一般都工作在全双工方式。
          - 交换机能同时连通许多对的端口，使每一对相互通信的主机都能像独占通信媒体那样，进行无碰撞地传输数据
          - 以太网交换机由于使用了专用的交换结构芯片，其交换速率就较高。
      - 用以太网交换机扩展局域网
      - ![](/home/eve/计网复习/第四局域网/广播域与冲突域.png)

6. 虚拟局域网(VLAN)

   - 虚拟局域网限制了接收广播信息的工作站数，使得网络
     不会因传播过多的广播信息(即“广播风暴”)而引起性能恶化

7. 高速以太网

   - 定义：速率达到或超过 100 Mb/s 的以太网称为高速以太网。
   - 100BASE-T 以太网又称为快速以太网(Fast Ethernet)。 
   - 1000BASE-T 以太网又称为千兆以太网(Giga Ethernet)。 

8. 100BASE-T 以太网的特点

   - MAC 帧格式仍然是 802.3 标准规定的。

   - 可使用CSMA/CD；或在全双工方式下工作而无冲突发生。

   - 保持最短帧长不变，但将一个网段的最大电缆长度减小到 100 m。

   - 帧间时间间隔从原来的 9.6 s 改为现在的 0.96 s。

   - 三种不同的物理层标准 

     - 100BASE-TX
       - 使用 2 对 UTP 5 类线或屏蔽双绞线 STP。
      - 100BASE-FX 
         - 使用 2 对光纤。 
     - 100BASE-T4
       - 用 4 对 UTP 3 类线或 5 类线。 

9. 吉比特以太网

   ![吉比特以太网的物理层](/home/eve/计网复习/第四局域网/吉比特以太网的物理层.png)

   - 允许在1Gb/s下全双工和半双工两种方式工作。
   - 使用 802.3 协议规定的帧格式。
   - 在半双工方式下使用 CSMA/CD 协议。
   - 全双工方式不需要使用 CSMA/CD 协议。
   - 与 10BASE-T 和 100BASE-T 技术向后兼容。

10. 无线局域网

    - 802.11 标准(无线局域网)
    - 无线局域网却不能简单地搬用 CSMA/CD 协议。这里主要有两个原因。
      - CSMA/CD 协议要求一个站点在发送本站数据的同时还必须不间断地检测信道，但在无线局域网的设备中要实现这种功能就花费过大。
      - 即使我们能够实现碰撞检测的功能，并且当我们在发送数据时检测到信道是空闲的，在接收端仍然有可能发生碰撞。  
    - 关于CSMA/CA 协议
      - 无线局域网不能使用 CSMA/CD，而只能使用改进的 CSMA 协议。
      - 改进的办法是将 CSMA 增加一个碰撞避免(Collision Avoidance)功能。
      - 802.11 就使用 CSMA/CA 协议。而在使用 CSMA/CA 的同时还增加使用确认机制。